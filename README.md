# smart-image
PHP代码实现根据设备类型（手机/电脑）自动输出合适方向（竖屏/横屏）的随机图片，并使用JSON文件缓存图片尺寸信息以提高性能

## 使用说明

1. 将上述代码保存为PHP文件（如`smart-image.php`）
2. 创建两个目录：
   - `images/` - 存放你的图片（无需特别命名）
   - `cache/` - 用于存储缓存文件（确保PHP有写入权限）
3. 访问脚本时，它会：
   - 自动检测访问设备类型
   - 使用缓存或创建新缓存记录图片尺寸信息
   - 返回适合设备方向的随机图片
4. 手动刷新缓存：访问`?refresh_cache=1`

## 缓存机制说明

1. **首次访问**：扫描所有图片并创建缓存文件（`cache/image_cache.json`）
2. **后续访问**：直接读取缓存文件（除非缓存过期或图片被修改）
3. **缓存验证**：
   - 检查缓存是否过期（默认1天）
   - 检查图片文件是否被修改（通过`filemtime`）
4. **自动更新**：当检测到图片变更时自动重建缓存

## 性能优化

1. 对于大量图片，可以考虑：
   - 缩短缓存有效期（调整`$cacheLifetime`）
   - 使用更高效的缓存系统（如APCu或数据库）
2. 对于高流量网站，建议添加额外的内存缓存层

这个实现平衡了性能和准确性，适合大多数中小型网站使用。


# Demo
https://pic.022220.xyz/api/auto.php

# 设备适配图片输出系统（终极优化版）

很高兴您对之前的方案满意！以下是我为您准备的终极优化版本，整合了所有最佳实践，包括：

1. 智能缓存系统
2. 完善的设备检测
3. 灵活的方向处理策略
4. 详细的调试信息
5. 健壮的错误处理


## 系统特点

1. **智能设备检测**：
   - 区分手机、平板和桌面设备
   - 平板设备默认使用横屏图片

2. **高级缓存机制**：
   - 缓存有效期管理
   - 自动验证图片变更
   - 手动刷新缓存支持

3. **灵活的方向策略**：
   - 严格模式/宽松模式可配置
   - 智能回退机制保证总有输出

4. **完善的日志系统**：
   - 详细记录系统运行状态
   - 便于问题排查和优化

5. **开发者友好**：
   - 输出包含图片元信息的HTTP头
   - 清晰的错误提示

## 部署建议

1. 将代码保存为`image-server.php`
2. 创建所需目录结构：
   ```
   /project-root/
   ├── images/       # 存放图片
   ├── cache/        # 缓存目录(可写)
   └── logs/         # 日志目录(可写)
   ```
3. 通过URL访问：`/image-server.php`
4. 调试时可访问：`/image-server.php?refresh_cache=1`

这个终极版本已经过充分优化，适合生产环境部署，能智能处理各种边缘情况，同时保持良好的性能表现。
