# smart-image
PHP代码实现根据设备类型（手机/电脑）自动输出合适方向（竖屏/横屏）的图片，并使用JSON文件缓存图片尺寸信息以提高性能
## 使用说明

1. 将上述代码保存为PHP文件（如`smart-image.php`）
2. 创建两个目录：
   - `images/` - 存放你的图片（无需特别命名）
   - `cache/` - 用于存储缓存文件（确保PHP有写入权限）
3. 访问脚本时，它会：
   - 自动检测访问设备类型
   - 使用缓存或创建新缓存记录图片尺寸信息
   - 返回适合设备方向的随机图片
4. 手动刷新缓存：访问`?refresh_cache=1`

## 缓存机制说明

1. **首次访问**：扫描所有图片并创建缓存文件（`cache/image_cache.json`）
2. **后续访问**：直接读取缓存文件（除非缓存过期或图片被修改）
3. **缓存验证**：
   - 检查缓存是否过期（默认1天）
   - 检查图片文件是否被修改（通过`filemtime`）
4. **自动更新**：当检测到图片变更时自动重建缓存

## 性能优化

1. 对于大量图片，可以考虑：
   - 缩短缓存有效期（调整`$cacheLifetime`）
   - 使用更高效的缓存系统（如APCu或数据库）
2. 对于高流量网站，建议添加额外的内存缓存层

这个实现平衡了性能和准确性，适合大多数中小型网站使用。
